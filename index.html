<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glitch The Matrix Payment</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
    }

    .container {
      display: grid;
      grid-template-columns: 40% 60%;
      min-height: 100vh;
    }

    /* Left Column - Course Carousel */
    .left-section {
      background-color: #012f1d;
      padding: 60px 50px;
      color: #e3a72f;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
    }

    .logo {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .course-carousel-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 30px;
    }

    .carousel-title {
      font-size: 28px;
      margin-bottom: 24px;
      font-weight: 600;
      text-align: center;
    }

    .course-carousel {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      gap: 20px;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: #e3a72f #012f1d;
    }

    .course-carousel::-webkit-scrollbar {
      height: 8px;
    }

    .course-carousel::-webkit-scrollbar-track {
      background: #012f1d;
      border-radius: 4px;
    }

    .course-carousel::-webkit-scrollbar-thumb {
      background: #e3a72f;
      border-radius: 4px;
    }

    .course-card {
      flex: 0 0 auto;
      width: 100%;
      max-width: 400px;
      scroll-snap-align: start;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .course-card:hover {
      transform: translateY(-5px);
    }

    .course-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-color: #e3a72f;
      border: 2px;
    }

    .course-description {
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: calc(100% - 180px); /* Adjust based on image height */
    }

    .course-description h3 {
      color: #fff;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .course-description p {
      color: #fff;
      font-size: 14px;
      line-height: 1.5;
      flex-grow: 1;
      margin-bottom: 15px;
    }

    .read-more-button {
      display: inline-block;
      padding: 10px 20px;
      background-color: #e3a72f;
      color: #012f1d;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid #e3a72f;
      margin-top: auto;
      margin-bottom: 12px;
    }

    .read-more-button:hover {
      background-color: transparent;
      color: #e3a72f;
      transform: translateY(-2px);
    }

    .carousel-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
    }

    .indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(227, 167, 47, 0.4);
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .indicator.active {
      background: #e3a72f;
    }

    .terms {
      padding: 20px;
      border: 1px solid transparent;
      border-color: #e3a72f;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.6;
      margin-top: auto;
    }

    .terms strong {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }

    /* Right Column - Form Section */
    .right-section {
      background: #012f1d;
      padding: 60px 80px;
      overflow-y: auto;
      color : #e3a72f;
    }

    .form-header {
      margin-bottom: 40px;
    }

    .form-header h1 {
      font-size: 32px;
      color: #fff;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .form-header p {
      color: #fff;
      font-size: 16px;
    }

    .form-group {
      margin-bottom: 28px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #fff;
      font-size: 15px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s ease;
      font-family: inherit;
      background: white;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #e3a72f;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .form-group select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 45px;
    }

    .price-display {
      background: #e3a72f;
      border: 2px solid #e3a72f;
      padding: 20px;
      border-radius: 12px;
      margin: 28px 0;
      display: none;
      align-items: center;
      justify-content: space-between;
    }

    .price-display.active {
      display: flex;
    }

    .price-display .label {
      font-size: 16px;
      color: #fff;
      font-weight: 500;
    }

    .price-display .amount {
      font-size: 36px;
      font-weight: 700;
      color: #fff;
    }

    .pay-button {
      width: 100%;
      padding: 18px;
      background-color: #fff;
      color: #e3a72f;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 12px;
    }

    .pay-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
    }

    .pay-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .pay-button:disabled {
      background-color: #000;
      cursor: not-allowed;
      transform: none;
    }

    /* Success Message */
    .success-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(9, 33, 2, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .success-overlay.active {
      display: flex;
    }

    .success-card {
      background: #012f1d;
      padding: 50px;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.4s ease;
      color: #e3a72f;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .success-card h2 {
      color: #e3a72f;
      margin-bottom: 12px;
      font-size: 28px;
    }

    .success-card > p {
      color: #fff;
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 15px;
    }

    .download-button {
      display: inline-block;
      padding: 16px 40px;
      background-color: #e3a72f;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      margin: 10px 0 24px;
      transition: all 0.3s ease;
      font-size: 16px;
    }

    .download-button:hover {
      background-color: #e3a72f;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgb(146, 146, 146);
    }

    .order-details {
      padding: 24px;
      margin-top: 24px;
      text-align: center;
      font-size: 14px;
    }

    .order-details p {
      margin-bottom: 10px;
      color: #e3a72f;
      border-color: #fff;
    }

    .order-details strong {
      color: #e3a72f;
    }

    .close-note {
      margin-top: 20px;
      font-size: 13px;
      color: #fff;
      font-style: italic;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }

      .left-section {
        padding: 40px 30px;
      }

      .right-section {
        padding: 40px 30px;
      }
    }

    @media (max-width: 600px) {
      .right-section {
        padding: 30px 20px;
      }

      .form-header h1 {
        font-size: 26px;
      }

      .success-card {
        padding: 30px 20px;
      }
      
      .course-card {
        max-width: 250px;
      }
    }
  </style>
</head>
<link rel="icon" type="image/x-icon" href="/favicon.ico"> 
<body>
  <div class="container">
    <!-- Left Column: Course Carousel -->
    <div class="left-section">
      <div class="course-carousel-container">
        <div class="logo">
          <a href="https://glitch.mambaclub.site/">
            <img src="https://github.com/glitchingthroughmatrix/image-hosting/blob/main/Glitch(banner).png?raw=true" alt="" width="100%">
          </a>
        </div>
        
        <h2 class="carousel-title">Available Courses</h2>
        
        <div class="course-carousel" id="course-carousel">
          <!-- Course cards will be dynamically added here -->
        </div>
        
        <div class="carousel-indicators" id="carousel-indicators">
          <!-- Indicators will be dynamically added here -->
        </div>
      </div>

      <div class="terms">
        <strong>Terms & Conditions</strong>
        This unofficial guide has been created solely for educational purposes and is not connected with any official organizations or companies. All trademarks and registered trademarks belong to their respective owners.
      </div>
    </div>

    <!-- Right Column: Form Section -->
    <div class="right-section">
      <div class="form-header">
        <h1>Make your first step out of mediocrity</h1>
        <p>Fill in your details to access the knowledge arsenal of your choice</p>
      </div>

      <form id="payment-form">
        <div class="form-group">
          <label for="name">Full Name *</label>
          <input type="text" id="name" name="name" placeholder="Enter your full name" required>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
        </div>
        
        <div class="form-group">
          <label for="contact">Phone Number *</label>
          <input type="tel" id="contact" name="contact" placeholder="+91 98765 43210" required>
        </div>
        
        <div class="form-group">
          <label for="notes">Select Course *</label>
          <select id="notes" name="notes" required>
            <option value="">-- Choose a course --</option>
          </select>
        </div>

        <div class="price-display" id="price-display">
          <span class="label">Total Amount:</span>
          <span class="amount" id="selected-price">₹0</span>
        </div>
        
        <button type="button" class="pay-button" id="pay-button" onclick="payNow()" disabled>
          Proceed to Payment →
        </button>
      </form>
    </div>
  </div>

  <!-- Success Message Overlay -->
  <div class="success-overlay" id="success-overlay">
    <div class="success-card">
      <img src="https://github.com/glitchingthroughmatrix/image-hosting/blob/main/glitchthematrix(no-background-logo).png?raw=true" alt="glitchthematrix" width="20%">
      <h2>Hustle Begins!</h2>
      <p>Your purchase is just the first step. But remember <br><strong>Knowledge is useless without execution.</strong></p>
      
      <a href="#" id="download-link" class="download-button" target="_blank">
        Access Your Course
      </a>
      
      <p style="font-size: 14px; color: #cecece;">
        The course access has also been sent to your email address.
      </p>
      
      <div class="order-details">
        <p><strong>Order ID:</strong> <span id="order-id"></span></p>
        <p><strong>Payment ID:</strong> <span id="payment-id"></span></p>
      </div>

      <p>Most people do not start in the first place. 
        <br>You have already distinguished yourself by accessing this ocean of money knowledge</p>

      <p class="close-note">Welcome to the elite few</p>
    </div>
  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    let notesData = [];

    document.addEventListener('DOMContentLoaded', function() {
      loadAvailableNotes();
      
      const form = document.getElementById('payment-form');
      const payButton = document.getElementById('pay-button');
      const courseSelect = document.getElementById('notes');
      const priceDisplay = document.getElementById('price-display');
      const selectedPriceEl = document.getElementById('selected-price');
      
      courseSelect.addEventListener('change', function() {
        const selectedCourse = notesData.find(note => note.id === this.value);
        if (selectedCourse) {
          selectedPriceEl.textContent = `₹${selectedCourse.price}`;
          priceDisplay.classList.add('active');
        } else {
          priceDisplay.classList.remove('active');
        }
      });

      form.addEventListener('input', function() {
        const isValid = form.checkValidity();
        payButton.disabled = !isValid;
      });
    });

    async function loadAvailableNotes() {
      try {
        const response = await fetch('api/get-notes');
        notesData = await response.json();
        
        // Populate course select dropdown
        const notesSelect = document.getElementById('notes');
        notesData.forEach(course => {
          const option = document.createElement('option');
          option.value = course.id;
          option.textContent = `${course.name} - ₹${course.price}`;
          notesSelect.appendChild(option);
        });
        
        // Create course cards for the carousel
        createCourseCarousel(notesData);
      } catch (error) {
        console.error('Error loading notes:', error);
        // Fallback data for demonstration
        const fallbackData = [
          {
            id: '1',
            name: 'Financial Freedom Blueprint',
            price: 2999,
            image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
            description: 'Learn the principles of financial independence and create a roadmap to achieve your money goals.'
          },
          {
            id: '2',
            name: 'Investment Mastery',
            price: 3999,
            image: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
            description: 'Master the art of investing in stocks, bonds, and real estate to grow your wealth exponentially.'
          },
          {
            id: '3',
            name: 'Entrepreneur Mindset',
            price: 2499,
            image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80',
            description: 'Develop the mindset and skills needed to build successful businesses and create multiple income streams.'
          }
        ];
        createCourseCarousel(fallbackData);
      }
    }

    function createCourseCarousel(courses) {
      const carousel = document.getElementById('course-carousel');
      const indicators = document.getElementById('carousel-indicators');
      
      // Clear existing content
      carousel.innerHTML = '';
      indicators.innerHTML = '';
      
      // Create course cards
      courses.forEach((course, index) => {
        // Create course card
        const card = document.createElement('div');
        card.className = 'course-card';
        
        // Build the card HTML with Read More button
        card.innerHTML = `
          <img src="${course.image}" alt="${course.name}" class="course-image">
          <div class="course-description">
            <h3>${course.name}</h3>
            <p>${course.description}</p>
            ${course.readMoreLink ? 
              `<a href="${course.readMoreLink}" class="read-more-button" target="_blank">Read More</a>` : 
              '<button class="read-more-button" disabled>Details Coming Soon</button>'
            }
          </div>
        `;
        carousel.appendChild(card);
        
        // Create indicator
        const indicator = document.createElement('div');
        indicator.className = 'indicator';
        if (index === 0) indicator.classList.add('active');
        indicator.addEventListener('click', () => {
          scrollToCard(index);
        });
        indicators.appendChild(indicator);
      });
      
      // Add scroll event listener to update active indicator
      carousel.addEventListener('scroll', updateActiveIndicator);
    }

    function scrollToCard(index) {
      const carousel = document.getElementById('course-carousel');
      const cards = carousel.querySelectorAll('.course-card');
      if (cards[index]) {
        cards[index].scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'start'
        });
      }
    }

    function updateActiveIndicator() {
      const carousel = document.getElementById('course-carousel');
      const cards = carousel.querySelectorAll('.course-card');
      const indicators = document.querySelectorAll('.indicator');
      
      // Find the card that's most visible
      let maxVisibility = 0;
      let activeIndex = 0;
      
      cards.forEach((card, index) => {
        const rect = card.getBoundingClientRect();
        const carouselRect = carousel.getBoundingClientRect();
        
        // Calculate how much of the card is visible in the carousel
        const visibleWidth = Math.min(rect.right, carouselRect.right) - Math.max(rect.left, carouselRect.left);
        const visibility = visibleWidth / card.offsetWidth;
        
        if (visibility > maxVisibility) {
          maxVisibility = visibility;
          activeIndex = index;
        }
      });
      
      // Update active indicator
      indicators.forEach((indicator, index) => {
        if (index === activeIndex) {
          indicator.classList.add('active');
        } else {
          indicator.classList.remove('active');
        }
      });
    }

    async function payNow() {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const contact = document.getElementById('contact').value;
      const selectedCourse = document.getElementById('notes').value;

      if (!name || !email || !contact || !selectedCourse) {
        alert('Please fill in all fields');
        return;
      }

      try {
        const response = await fetch('api/create-order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            selectedNote: selectedCourse,
            name: name,
            email: email,
            contact: contact
          })
        });

        const order = await response.json();

        const courseSelect = document.getElementById('notes');
        const selectedOption = courseSelect.options[courseSelect.selectedIndex];
        const productName = selectedOption.textContent.split(' - ₹')[0];

        const options = {
          key: 'rzp_live_RP5EQelgnPuwiH',
          amount: order.amount,
          currency: order.currency,
          name: 'Glitch The Matrix',
          description: 'Premium ' + productName,
          image: 'https://lh3.googleusercontent.com/sitesv/AICyYdYpDcon-1c9gvp-gXOYlvfte_VdQdjVCuGimxczaga3NcQzKAyPAyYMs3jpRVgKUYCquf1hoF8twCS1rE3mu2quEWUTxte9GbybNUEuZsrCY3ixfS3aQkakkyATvpwKmjkJG_DfmXLm2sONmrj2lzZvgkUuRAmCoOsQQHlAVc0WdbGL9iLKf69d=w16383',
          order_id: order.id,
          prefill: {
            name: name,
            email: email,
            contact: contact
          },
          theme: {
            color: '#012f1d'
          },
          handler: function (response) {
            verifyPayment(response);
          },
          modal: {
            ondismiss: function() {
              console.log('Checkout form closed by user');
            }
          }
        };

        const rzp = new Razorpay(options);
        rzp.open();
        
      } catch (error) {
        console.error('Error:', error);
        alert('Error creating order. Please try again.');
      }
    }

    function verifyPayment(response) {
      fetch('api/verify-payment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          razorpay_order_id: response.razorpay_order_id,
          razorpay_payment_id: response.razorpay_payment_id,
          razorpay_signature: response.razorpay_signature
        })
      }).then(res => res.json())
        .then(data => {
          if (data.status === 'ok') {
            showSuccessMessage(response, data.download_link, data.product_name);
          } else {
            alert('Payment verification failed. Please contact support with your order ID: ' + response.razorpay_order_id);
          }
        }).catch(error => {
          console.error('Error:', error);
          alert('Error verifying payment. Please contact support with your order ID: ' + response.razorpay_order_id);
        });
    }

    function showSuccessMessage(response, downloadLink, productName) {
      document.getElementById('order-id').textContent = response.razorpay_order_id;
      document.getElementById('payment-id').textContent = response.razorpay_payment_id;
      document.getElementById('download-link').href = downloadLink;
      
      document.getElementById('success-overlay').classList.add('active');
      
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'PAYMENT_SUCCESS',
          order_id: response.razorpay_order_id,
          payment_id: response.razorpay_payment_id,
          product: productName,
          download_link: downloadLink
        }, '*');
      }
    }

    window.addEventListener('message', function(event) {
      if (event.data.type === 'INIT_PAYMENT') {
        console.log('Received init message from parent:', event.data);
      }
    });
  </script>
</body>
</html>
